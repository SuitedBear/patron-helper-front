(this["webpackJsonppatron-front"]=this["webpackJsonppatron-front"]||[]).push([[0],{17:function(e,t,n){e.exports=n(25)},22:function(e,t,n){},23:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(15),i=n.n(s),o=(n(22),n(4)),c=n(5),l=n(2),u=n(7),d=n(8),h=(n(23),n(9)),p=n(12),v=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={email:"",password:""},a.handleChange=a.handleChange.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=Object(p.a)({},this.state);this.props.onLogin(t)}},{key:"handleChange",value:function(e){this.setState(Object(h.a)({},e.target.id,e.target.value))}},{key:"handleFailedLogin",value:function(e){if(e)return r.a.createElement("div",{style:{color:"red"}},"Invalid email or password!")}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.handleFailedLogin(this.props.failedLogin),r.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"mail"},"email:",r.a.createElement("input",{name:"email",id:"email",type:"email",value:this.state.email,onChange:this.handleChange}))),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"pass"},"password:",r.a.createElement("input",{name:"password",id:"password",type:"password",value:this.state.password,onChange:this.handleChange}))),r.a.createElement("input",{type:"submit",value:"Log in"})),r.a.createElement("button",{onClick:function(){return e.props.onStateChange(2)}},"Sign up"))}}]),n}(r.a.Component),m=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={name:"",email:"",password:""},a.handleChange=a.handleChange.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"handleChange",value:function(e){this.setState(Object(h.a)({},e.target.id,e.target.value))}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=Object(p.a)({},this.state);this.props.onSignup(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",null,"Sign up"),r.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},r.a.createElement("label",{htmlFor:"name"},"User name:",r.a.createElement("input",{name:"name",id:"name",type:"text",value:this.state.name,onChange:this.handleChange})),r.a.createElement("label",{htmlFor:"email"},"e-mail:",r.a.createElement("input",{name:"email",id:"email",type:"email",value:this.state.email,onChange:this.handleChange})),r.a.createElement("label",{htmlFor:"password"},"password:",r.a.createElement("input",{name:"password",id:"password",type:"password",value:this.state.password,onChange:this.handleChange})),r.a.createElement("input",{type:"submit",value:"Sign Up"})),r.a.createElement("button",{onClick:function(){return e.props.onStateChange(0)}},"Login"))}}]),n}(r.a.Component),f=n(1);function E(e){return r.a.createElement("nav",null,r.a.createElement("ul",{style:{listStyle:"none"}},r.a.createElement("li",{onClick:function(){return e.setServiceId(0)}},"Services list"),r.a.createElement("li",{onClick:function(){return e.setServiceId(-1)}},"Edit user"),e.serviceId>0?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{onClick:function(){return e.setSubService(0)}},"Service info"),r.a.createElement("li",{onClick:function(){return e.setSubService(1)}},"Levels"),r.a.createElement("li",{onClick:function(){return e.setSubService(2)}},"Patrons"),r.a.createElement("li",{onClick:function(){return e.setSubService(3)}},"To Do")):r.a.createElement("br",null),r.a.createElement("li",{onClick:function(){return e.onLogout(0)}},"Logout")))}function b(e){return r.a.createElement("div",null,"User Edit")}var g=n(3),S=n.n(g),y=n(6);function k(e){var t=r.a.useState([]),n=Object(f.a)(t,2),a=n[0],s=n[1];return r.a.useEffect((function(){function t(){return(t=Object(y.a)(S.a.mark((function e(t){var n,a,i;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,window.fetch("".concat(t.serverAddress,"/services"),{mode:"cors",headers:{Authorization:"Bearer ".concat(t.token)}});case 3:if(!(a=e.sent).ok){e.next=9;break}return e.next=7,a.json();case 7:i=e.sent,n=i.map((function(e){return r.a.createElement("li",{key:e.id,onClick:function(){return t.setServiceId(e.id)}},e.name)}));case 9:s(n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}console.log("serviceList render"),function(e){t.apply(this,arguments)}(e)}),[e]),r.a.createElement("div",null,r.a.createElement("p",null,"Service List"),r.a.createElement("ul",{style:{listStyle:"none"}},a))}var O=n(13),j=n(16);function w(e){var t,n=[],a=Object(O.a)(e.keys);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push(r.a.createElement("span",{style:{border:"1px solid black",padding:"1px"},key:s,onDoubleClick:function(t){return e.onRowClick(t,e.data)}},"".concat(e.data[s])))}}catch(i){a.e(i)}finally{a.f()}return r.a.createElement("li",{style:{padding:"2px 0"}},n)}var C=["done","for shipment","in progress","new"],L=new Map([["user",function(e){var t=Object(a.useState)(e.entry[1]),n=Object(f.a)(t,2),s=n[0],i=n[1];return r.a.createElement("span",{style:{border:"1px solid black",padding:"1px"}},r.a.createElement("input",{id:e.entry[0],name:e.entry[0],size:16,value:s,onChange:function(e){return i(e.target.value)}}))}],["active",function(e){return r.a.createElement("span",{style:{border:"1px solid black",padding:"1px"}},r.a.createElement("input",{type:"checkbox",id:e.entry[0],name:e.entry[0],defaultChecked:"true"===e.entry[1]}))}],["value",function(e){return r.a.createElement("span",{style:{border:"1px solid black",padding:"1px"}},r.a.createElement("input",{id:e.entry[0],name:e.entry[0],type:"number",min:0,defaultValue:e.entry[1]}))}],["status",function(e){var t=e.optionList.map((function(e){return r.a.createElement("option",{key:e,value:e},e)}));return r.a.createElement("span",{style:{border:"1px solid black",padding:"1px"}},r.a.createElement("select",{id:e.entry[0],name:e.entry[0],defaultValue:e.entry[1]},t))}]]);function x(e){var t=e.types||L,n=Object.entries(e.dataPoint).map((function(e){var n=t.get(e[0]);return n?r.a.createElement(n,{key:e[0],entry:e,optionList:C}):r.a.createElement("span",{key:e[0],style:{border:"1px solid black",padding:"1px"}},e[1])}));return r.a.createElement("li",{style:{padding:"0"}},r.a.createElement("form",{onSubmit:function(t){return e.onHandleEdit(t)}},n,r.a.createElement("input",{type:"submit",value:"Save"})))}var A=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;Object(o.a)(this,n),a=t.call(this,e);for(var r=new Map,s=0,i=Object.keys(a.props.data[0]);s<i.length;s++){var c=i[s];r.set(c,!0)}var u=new Map;return a.props.data.forEach((function(e){return u.set(e.id,e)})),a.types=a.props.types||null,a.state={editFocus:-1,sortMap:r,dataMap:u},a.handleSort=a.handleSort.bind(Object(l.a)(a)),a.handleDataRow=a.handleDataRow.bind(Object(l.a)(a)),a.handleEdit=a.handleEdit.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"handleSort",value:function(e){var t=new Map(this.state.sortMap),n=Object(j.a)(this.state.dataMap.values()).sort((function(n,a){return n[e]===a[e]?0:t.get(e)?n[e]>a[e]?1:-1:n[e]<a[e]?1:-1})),a=new Map;n.forEach((function(e){return a.set(e.id,e)})),t.set(e,!t.get(e)),this.setState({dataMap:a,sortMap:t})}},{key:"handleDataRow",value:function(e,t){console.log(e.target),console.log(e.target.parentNode),console.log(t),this.setState({editFocus:t.id})}},{key:"handleEdit",value:function(e){e.preventDefault(),console.log(e.target.elements[2].value),this.setState({editFocus:-1})}},{key:"render",value:function(){var e,t=this,n=this.state,a=n.dataMap,s=n.sortMap,i=n.editFocus,o=Array.from(s.keys()),c=o.map((function(e){return r.a.createElement("button",{key:e,onClick:function(){return t.handleSort(e)}},e)})),l=[],u=Object(O.a)(a);try{for(u.s();!(e=u.n()).done;){var d=e.value;d[0]===i?l.push(r.a.createElement(x,{key:d[0],dataPoint:a.get(i),onHandleEdit:this.handleEdit,types:this.types})):l.push(r.a.createElement(w,{key:d[0],data:d[1],keys:o,onRowClick:this.handleDataRow}))}}catch(h){u.e(h)}finally{u.f()}return r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{style:{listStyle:"none"}},r.a.createElement("li",null,c),l))}}]),n}(r.a.Component);function I(e){var t=r.a.useState(null),n=Object(f.a)(t,2),a=n[0],s=n[1];return r.a.useEffect((function(){function t(){return(t=Object(y.a)(S.a.mark((function t(){var n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("".concat(e.serverAddress,"/services/").concat(e.serviceId,"/levels"),{mode:"cors",headers:{Authorization:"Bearer ".concat(e.token)}});case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:a=t.sent,s(a);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e]),r.a.createElement("div",null,a?r.a.createElement(A,{data:a}):r.a.createElement("div",null,"Loading Level List..."))}function M(e){var t=r.a.useState(null),n=Object(f.a)(t,2),a=n[0],s=n[1];return r.a.useEffect((function(){function t(){return(t=Object(y.a)(S.a.mark((function t(){var n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("".concat(e.serverAddress,"/services/").concat(e.serviceId,"/patrons"),{mode:"cors",headers:{Authorization:"Bearer ".concat(e.token)}});case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:a=t.sent,s(a);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e]),r.a.createElement("div",null,a?r.a.createElement(A,{data:a}):r.a.createElement("div",null,"Loading Patron List..."))}function D(e){var t=r.a.useState(null),n=Object(f.a)(t,2),a=n[0],s=n[1];return r.a.useEffect((function(){function t(){return(t=Object(y.a)(S.a.mark((function t(){var n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("".concat(e.serverAddress,"/services/").concat(e.serviceId,"/patrons"),{mode:"cors",headers:{Authorization:"Bearer ".concat(e.token)}});case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:a=t.sent,s(a);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e]),r.a.createElement("div",null,a?r.a.createElement(A,{data:a}):r.a.createElement("div",null,"Loading Patron List..."))}function F(e){var t=r.a.useState(r.a.createElement("p",null,"Service not loaded")),n=Object(f.a)(t,2),a=n[0],s=n[1];return r.a.useLayoutEffect((function(){switch(console.log("Service Layout Effect fired"),e.subService){case 1:s(r.a.createElement(I,{serviceId:e.serviceId,token:e.token,serverAddress:e.serverAddress}));break;case 2:s(r.a.createElement(M,{serviceId:e.serviceId,token:e.token,serverAddress:e.serverAddress}));break;case 3:s(r.a.createElement(D,{serviceId:e.serviceId,token:e.token,serverAddress:e.serverAddress}));break;default:s(r.a.createElement("div",null,"Service Main"))}}),[e]),r.a.createElement("div",null,"service ID ",e.serviceId,a)}function P(e){var t=r.a.useState(0),n=Object(f.a)(t,2),a=n[0],s=n[1],i=r.a.useState(0),o=Object(f.a)(i,2),c=o[0],l=o[1];return r.a.createElement("div",null,r.a.createElement(E,{serviceId:a,setServiceId:s,setSubService:l,onLogout:e.onStateChange}),a>0?r.a.createElement(F,{serviceId:a,subService:c,serverAddress:e.serverAddress,token:e.token}):-1===a?r.a.createElement(b,null):r.a.createElement(k,{serverAddress:e.serverAddress,token:e.token,setServiceId:s}))}var U=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).serverAddress=e.serverAddress,a.userStates=["logged out","logged in","signing up"],a.state={userState:0,token:null,failedLogin:!1},a.handleUserState=a.handleUserState.bind(Object(l.a)(a)),a.handleLogin=a.handleLogin.bind(Object(l.a)(a)),a.handleSignup=a.handleSignup.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"handlePage",value:function(e){switch(e){case 1:return r.a.createElement(P,{serverAddress:this.serverAddress,onStateChange:this.handleUserState,token:this.state.token});case 2:return r.a.createElement(m,{onStateChange:this.handleUserState,onSignup:this.handleSignup});default:return r.a.createElement(v,{onStateChange:this.handleUserState,onLogin:this.handleLogin,failedLogin:this.state.failedLogin})}}},{key:"handleUserState",value:function(e){e!==this.state.userState&&(2===e?this.setState({userState:e}):this.setState({userState:e,token:null}))}},{key:"handleLogin",value:function(e){var t=this;console.log(e),window.fetch("".concat(this.serverAddress,"/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.status<400?e.json():(t.setState({userState:0,failedLogin:!0}),"login failed!")})).then((function(e){e.token&&t.setState({token:e.token,userState:1,failedLogin:!1})})).catch((function(e){return console.log(e)}))}},{key:"handleSignup",value:function(e){var t=this;console.log(e),window.fetch("".concat(this.serverAddress,"/signup"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.status<400?e.json():"signup failed"})).then((function(e){return console.log(e),t.setState({userState:0}),"signup successfull"})).catch((function(e){return console.log(e)}))}},{key:"render",value:function(){return r.a.createElement("div",{id:"App"},r.a.createElement("div",null,"current state: ",this.userStates[this.state.userState]),this.handlePage(this.state.userState))}}]),n}(r.a.Component);i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,{serverAddress:Object({NODE_ENV:"production",PUBLIC_URL:"/patron-helper-front",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).SERV_URI||"http://127.0.0.1:3000"})),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.73b1c3ed.chunk.js.map